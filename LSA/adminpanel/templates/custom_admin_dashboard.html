{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="{% static 'css/style.css' %}?v=1">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const api_navbar_access_tabsView_url =  "{% url 'api_navbar_access_tabsView' %}";
        const api_dashboard_preview_admin_view_url =  "{% url 'api_dashboard_preview_admin_view' %}";
        const adminupdaetkycapprovalUrl =  "{% url 'user-kyc-status-update' %}";
        const csrfToken = "{{ csrf_token }}";
        const lottery_events_add_csrftoken="{{ csrf_token}}"; 
        const api_get_lottery_events_url = "{% url 'api_get_lottery_events' %}";
        const api_lottery_events_add_url = "{% url 'api_lottery_events_add' %}";
        const apiEditDeleteLotteryEventsUrl = "{% url 'api_edit_delete_lottery_events' 0 %}";
        const get_lottery_categories_url = "{% url 'get-lottery-categories' %}";
        const admin_chats_csrfToken = "{{ csrf_token }}";
    </script>
    <style>
/* Hide cards after the third one */
.lottery-event-card:nth-child(n+4) {
    display: none;
}

</style>

</head>
<body>
    <div class="custom_admin_dashboard_container">
        <!-- Sidebar -->
        <aside class="custom_admin_dashboard_sidebar" >
            <h2>LSA</h2>
            <nav>
                <ul>
                    <!-- Tabs will be dynamically appended here -->
                </ul>
                <!-- Static logout link -->
              <a class="custom_admin_dashboard_logout" href="{% url 'admin_logout_view' %}">Logout</a>
                
            </nav>
        </aside>
        <!-- Main Content -->
        <main class="custom_admin_dashboard_main">
            <header class="custom_admin_dashboard_topbar">
                <input type="text" placeholder="Search card" class="custom_admin_dashboard_search-bar">
                <div class="custom_admin_dashboard_account-info">
                    <span class="custom_admin_dashboard_icon">ðŸ””</span>
                    <span class="custom_admin_dashboard_icon">ðŸ‘¤</span>
                </div>
            </header>
            <section class="custom_admin_dashboard_dashboard">
                <h1>Admin Management: System Overview</h1>
                <div class="custom_admin_dashboard_overview_count" id="custom_admin_dashboard_overview_dynamic_count">
                </div> 
               
                <div class="custom_admin_dashboard_conversion_rate" id="custom_admin_dashboard_conversion_dynamic_rate_table">
                    <!-- Dynamic table will be rendered here -->
                </div>
                <div style=" visibility: hidden;opacity: 0;position: absolute;" id="custom_admin_dashboard_dynamic_lottery_sales_count_and_bar_chart">
               <div id="lottery_sales_dynamic_count_filter" style="display: none;"> <label for="month">Month:</label>
    <select id="month">
        <option value="1">January</option>
        <option value="2">February</option>
        <option value="3">March</option>
        <option value="4">April</option>
        <option value="5">May</option>
        <option value="6">June</option>
        <option value="7">July</option>
        <option value="8">August</option>
        <option value="9">September</option>
        <option value="10">October</option>
        <option value="11">November</option>
        <option value="12">December</option>
    </select>

    <label for="year">Year:</label>
    <select id="year">
        <option value="2023">2023</option>
        <option value="2024">2024</option>
        <option value="2025">2025</option>
    </select>

    <button id="filterBtn">Filter</button></div>

                <div class="custom_admin_dashboard_overview_statistics_count" >
                </div>
           
            <div>
                <div id="custom_admin_dashboard_bar_chart_filter" style="display: none;">
                <h1>Monthly Sales Chart</h1>
    
        <!-- Year Selection Dropdown -->
        <label for="yearSelect">Select Year:</label>
        <select id="yearSelect"></select></div>
    <div style="width: 50%;height: 50%;">
        <canvas id="salesChart" width="800" height="400"></canvas></div>
               </div>
               <h1 id="leaderboard_title"></h1>
               <div class="leaderboard_class" id="leaderboard" style="display: none;">
                <!-- Data will be injected here -->
              </div>
            </div>
                <div class="custom_admin_dashboard_user_table" id="custom_admin_dashboard_user_list_table">
                    <!-- Dynamic table will be rendered here -->
                </div>
                <div id="lottery_cards_add_and_list">
                    <!-- "+" Icon -->
                    <div class="lottery_cards_heading" >
                       
                    <h2 id="lottery_card_title"></h2>
                    <button id="custom_admin_dashboard_openFormButton" class="custom_admin_dashboard_open-form-btn">+</button> 
                    </div>
                   
                    <div id="lottery-events-wrapper">
                        <input type="checkbox" id="custom_admin_dashboard_lottery_view-more-toggle">
                        <div id="lottery-events-container" class="custom_admin_dashboard_lottery-events-grid">
                            <!-- Lottery event cards will be dynamically injected here -->
                        </div>
                        <label for="custom_admin_dashboard_lottery_view-more-toggle" id="custom_admin_dashboard_view-more-button" class="custom_admin_dashboard_lottery_view-more-btn"  hidden>View More</label>
                    </div>
                </div>

                <div class="admin_contact_reply_container" id="admin_reply_chat_bot" style=" visibility: hidden;opacity: 0;position: absolute;">
                    <button id="admin_contact_reply_back_button" style="display: none;">Back</button>
                    <h1 class="admin_contact_reply_heading">Contact Messages</h1>
                    <div id="admin_contact_reply_message_list" class="admin_contact_reply_chat_container">
                        <!-- Dynamic content loaded via JavaScript -->
                    </div>
                
                    <div id="admin_contact_reply_form_container" style="display: none;">
                        <h2 class="admin_contact_reply_sub_heading">Reply to User</h2>
                        <form id="admin_contact_reply_form" class="admin_reply_form">
                            <input type="email" id="admin_contact_reply_email" name="email" placeholder="User Email" readonly>
                            <textarea id="admin_contact_reply_message" name="message" placeholder="Your reply..."></textarea>
                            <input type="file" id="admin_contact_reply_file" name="file" accept="image/*,.pdf,.doc,.docx,.xlsx,.pptx">
                            <button type="submit">Send Reply</button>
                        </form>
                        <p id="admin_contact_reply_response_message"></p>
                    </div>
                </div> 
                
            </section>
        </main>
    </div>
    <div id="admin_contact_reply_editMessageModal" class="admin_contact_reply_modal" style="display: none;">
        <div class="admin_contact_reply_modal_content">
            <span class="admin_contact_reply_close" id="admin_contact_reply_closeEditModal">&times;</span>
            <h2>Edit Message</h2>
            <form id="admin_contact_reply_editMessageForm">
                <textarea id="admin_contact_reply_editMessageInput" placeholder="Edit your message..." rows="4"></textarea>
                <input type="file" id="admin_contact_reply_editMessageFile" accept="image/*,.pdf,.doc,.docx,.xlsx,.pptx" />
                <button type="submit">Save Changes</button>
            </form>
        </div>
    </div>    
        <!-- Modal for viewing the KYC image -->
<div id="custom_admin_user_kyc_waiting_list-kycModal" class="user_kyc_waiting_list-modal">
    <div class="user_kyc_waiting_list-modal-content">
        <div class="user_kyc_waiting_list-modal-header">
            <span id="custom_admin_user_kyc_waiting_list-userName"></span> | 
            <span id="custom_admin_user_kyc_waiting_list-userEmail"></span> | 
            <span id="custom_admin_user_kyc_waiting_list-kycStatus"></span>
        </div>
        <span class="user_kyc_waiting_list-close-btn">&times;</span>
        <img id="custom_admin_user_kyc_waiting_list-kycImage" class="user_kyc_waiting_list-modal-image" src="" alt="KYC Image">
    </div>
</div>

<!-- Modal Structure -->
<div id="lotteryEventModal" class="custom_admin_dashboard_modal">
    <div class="custom_admin_dashboard_modal-content">
        <span class="custom_admin_dashboard_close-button" id="custom_admin_dashboard_closeModal">&times;</span>
        <h2>Add New Lottery Event</h2>
        <form id="addLotteryEventForm" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="text" name="title" placeholder="Title" required><br>
            <span class="lottery_events_add_title_error" id="lottery_events_add_title_validation"></span><br>
        
            <input type="text" name="slug" placeholder="Slug (leave blank to auto-generate)" optional><br>
            <span class="lottery_events_add_slug_error" id="lottery_events_add_slug_validation"></span><br>
        
        
            <textarea name="description" placeholder="Description" required></textarea><br>
            <span class="lottery_events_add_description_error" id="lottery_events_add_description_validation"></span><br>
            <label for="category">Category:</label>
            <select id="lottery_events_add_category" name="category" required>
                <option value="">Select Category</option>
            </select>
            <span class="lottery_events_add_category_error" id="lottery_events_add_category_validation"></span><br>
        
            <input type="number" name="price" placeholder="Price" min="0" required><br>
            <span class="lottery_events_add_price_error" id="lottery_events_add_price_validation"></span><br>
        
            <input type="datetime-local" name="draw_date" required><br>
            <span class="lottery_events_add_drawdate_error" id="lottery_events_add_drawdate_validation"></span><br>
        
            <input type="file" name="image" accept="image/*" required><br>
            <span class="lottery_events_add_image_error" id="lottery_events_add_image_validation"></span><br>
        
            <input type="checkbox" name="is_active" checked> Active<br>
            <span class="lottery_events_add_isactive_error" id="lottery_events_add_isactive_validation"></span><br>
        
          
        <!-- Total Budget Amount -->
        <label for="totalBudget">Total Budget Amount:</label>
        <input type="number" id="lottery_events_add_totalBudget" name="total_budget" placeholder="Enter Total Budget" min="0" required><br>
        <span class="lottery_events_add_budget_error" id="lottery_events_add_budget_validation"></span><br>
        <!-- Revenue Type -->
        <label for="revenueType">Revenue Type:</label>
        <select id="lottery_events_add_revenueType" name="revenue_type">
            <option value="fixed">Fixed Amount</option>
            <option value="percentage">Percentage</option>
        </select><br>
        <span class="lottery_events_add_revenue_type_error" id="lottery_events_add_revenue_type_validation"></span><br>
        
        <!-- Revenue Input -->
        <div id="lottery_events_add_fixedAmountInput">
            <label for="fixedRevenue">Fixed Revenue Amount:</label>
            <input type="number" id="lottery_events_add_fixedRevenue" name="fixed_revenue" placeholder="Enter Fixed Revenue" min="0"><br>
            <span class="lottery_events_add_fixed_revenue_error" id="lottery_events_add_fixed_revenue_validation"></span><br>
        </div>
        
        <div id="lottery_events_add_percentageInput" style="display: none;">
            <label for="percentageRevenue">Percentage Revenue:</label>
           
            <input type="number" id="lottery_events_add_percentageRevenue" name="percentage_revenue" placeholder="Enter percentage" min="0"  max="100"  oninput="this.value = Math.min(Math.max(this.value, 0), 100)" required><br>
            <span class="lottery_events_add_percentage_revenue_error" id="lottery_events_add_percentage_revenue_validation"></span><br>
        </div>
        
        <!-- Display Total Amount -->
        <div id="lottery_events_add_total_amount_container" style="display: none;">
            <label for="totalAmount">Total Amount:</label>
            <input type="number" id="lottery_events_add_totalAmount" name="total_amount" readonly><br>
            <span class="lottery_events_add_total_amount_error" id="lottery_events_add_total_amount_validation"></span><br>
        </div>
        
        <!-- Per Ticket Price -->
        <label for="perTicketPrice">Per Ticket Price:</label>
        <input type="number" id="lottery_events_add_perTicketPrice" name="per_ticket_price" placeholder="Enter Per Ticket Price" min="0" required><br>
        <span class="lottery_events_add_per_ticket_error" id="lottery_events_add_per_ticket_validation"></span><br>
        <!-- Display Total Tickets -->
        <div id="lottery_events_add_total_tickets_container" style="display: none;">
            <label for="totalTickets">Total Tickets:</label>
            <input type="number" id="lottery_events_add_totalTickets" name="calculated_total_tickets" readonly><br>
            <span class="lottery_events_add_total_tickets_error" id="lottery_events_add_total_tickets_validation"></span><br>
        </div>
        <input type="number" name="mini_limit" placeholder="Minimum Tickets" min="1" required><br>
        <span class="lottery_events_add_minilimit_error" id="lottery_events_add_minilimit_validation"></span><br>
        
        <input type="number" name="max_limit" placeholder="Maximum Tickets" min="0" required><br>
        <span class="lottery_events_add_maxlimit_error" id="lottery_events_add_maxlimit_validation"></span><br>
        
        <textarea name="free_postal_description" placeholder="Free Postal Description" required></textarea><br>
        <span class="lottery_events_add_freepostal_error" id="lottery_events_add_freepostal_validation"></span><br>
        
        <textarea name="competition_details" placeholder="Competition Details" required></textarea><br>
        <span class="lottery_events_add_competitiondetails_error" id="lottery_events_add_competitiondetails_validation"></span><br>
        
        <h3>Additional Images</h3>
        <div id="additional-images-container">
        </div>
        <button type="button" id="add-image-button">Add Another Image</button>
        <br><br>
        <button type="button" onclick="submitAddLotteryEvent()">Add Event</button>
        </form>
         </div>
</div>
</body>
<script src="{% static 'js/custom.js' %}"></script>
<script src="{% static 'plugins/chart.js' %}"></script>

</html>